(window.webpackJsonp=window.webpackJsonp||[]).push([[460],{889:function(a,t,n){"use strict";n.r(t);var s=n(29),e=Object(s.a)({},(function(){var a=this,t=a.$createElement,n=a._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[n("h1",{attrs:{id:"cdn-推流集成"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cdn-推流集成"}},[a._v("#")]),a._v(" CDN 推流集成")]),a._v(" "),n("p",[a._v("集成 CDN 推流功能前，请确保您已经集成了基础的多方音视频通话功能。")]),a._v(" "),n("p",[a._v("CDN 推流服务适用于各类音视频直播场景，如企业级音视频会议、赛事、游戏直播、在线教育、娱乐直播等。")]),a._v(" "),n("p",[a._v("CDN 推流集成简单高效，开发者只需调用相关 API 即可将 CDN 推流无缝对接到自己的业务应用中。")]),a._v(" "),n("h2",{attrs:{id:"设置推流地址"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#设置推流地址"}},[a._v("#")]),a._v(" 设置推流地址")]),a._v(" "),n("p",[a._v("如要开启 CDN 推流，需在 加入频道前 进行 CDN 推流地址的设置。推流地址是将音视频流数据推送到的地址，用户通过输入该地址就可以在线观看。推流地址的设置具体为通过 JCMediaChannelJoinParam 对象中的 cdn 属性进行设置。")]),a._v(" "),n("p",[a._v("示例代码")]),a._v(" "),n("div",{staticClass:"language-objectivec extra-class"},[n("pre",{pre:!0,attrs:{class:"language-objectivec"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 设置 CDN 推流地址")]),a._v("\nJCMediaChannelJoinParam "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v("joinParam "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("JCMediaChannelJoinParam alloc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\njoinParam"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("cdn "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('@"推流地址"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 加入频道")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("mediaChannel join"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('@"channelId"')]),a._v(" joinParam"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("joinParam"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),n("h2",{attrs:{id:"获取-cdn-推流状态"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#获取-cdn-推流状态"}},[a._v("#")]),a._v(" 获取 CDN 推流状态")]),a._v(" "),n("p",[a._v("开启 CDN 推流前需要判断 CDN 的状态，通过 JCMediaChannel 类的 cdnState 属性获取推流器状态。只有 CDN 当前状态不为 JCMediaChannelCdnStateNone 时才可以进行 CDN 推流。其中，CDN 推流状态有以下几种")]),a._v(" "),n("div",{staticClass:"language-objectivec extra-class"},[n("pre",{pre:!0,attrs:{class:"language-objectivec"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/// 无法进行CDN推流")]),a._v("\nJCMediaChannelCdnStateNone"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/// 可以开启CDN推流")]),a._v("\nJCMediaChannelCdnStateReady"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/// CDN推流中")]),a._v("\nJCMediaChannelCdnStateRunning"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n")])])]),n("p",[a._v("当 CDN 状态发生改变时，会触发 onMediaChannelPropertyChange 回调")]),a._v(" "),n("div",{staticClass:"language-objectivec extra-class"},[n("pre",{pre:!0,attrs:{class:"language-objectivec"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n *  @brief 属性变化回调，目前主要关注屏幕共享状态的更新\n *  @param changeParam 变化标识集合\n */")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("onMediaChannelPropertyChange"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("JCMediaChannelPropChangeParam "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("changeParam"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),n("h2",{attrs:{id:"开启或关闭-cdn-推流"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#开启或关闭-cdn-推流"}},[a._v("#")]),a._v(" 开启或关闭 CDN 推流")]),a._v(" "),n("p",[a._v("CDN 状态获取后，即可根据 CDN 的状态开启或关闭 CDN 推流，接口如下")]),a._v(" "),n("div",{staticClass:"language-objectivec extra-class"},[n("pre",{pre:!0,attrs:{class:"language-objectivec"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n *  @brief              开关Cdn推流\n *  @param enable       是否开启Cdn推流\n *  @param keyInterval  推流关键帧间隔(毫秒)，当 enable 为 true 时有效，-1表示使用默认值(5000毫秒)，有效值需要>=1000\n *  @return             返回 true 表示正常执行调用流程，false 表示调用异常\n *  @warning 在收到 onMediaChannelPropertyChange 回调后检查是否开启\n */")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("bool"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("enableCdn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("bool"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("enable keyInterval"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("keyInterval"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),n("p",[a._v("示例代码")]),a._v(" "),n("div",{staticClass:"language-objectivec extra-class"},[n("pre",{pre:!0,attrs:{class:"language-objectivec"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("onMediaChannelPropertyChange"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("JCMediaChannelPropChangeParam "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("changeParam "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("changeParam"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("cdnState"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// CDN 状态变化")]),a._v("\n       JCMediaChannelCdnState cdnState "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("  mediaChannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("cdnState"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 根据CDN推流状态判断是否开启推流")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("cdnState "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" JCMediaChannelCdnStateNone"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 无法使用 CDN 推流")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("cdnState "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" JCMediaChannelCdnStateReady"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 可以开启 CDN 推流")]),a._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("mediaChannel enableCdn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("true keyInterval"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("cdnState "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" JCMediaChannelCdnStateRunning"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// CDN 推流中，可以关闭 CDN 推流")]),a._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("mediaChannel enableCdn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("false keyInterval"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);