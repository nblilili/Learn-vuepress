(window.webpackJsonp=window.webpackJsonp||[]).push([[485],{920:function(t,a,n){"use strict";n.r(a);var s=n(29),e=Object(s.a)({},(function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"服务器音视频录制集成"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#服务器音视频录制集成"}},[t._v("#")]),t._v(" 服务器音视频录制集成")]),t._v(" "),n("p",[t._v("集成服务器音视频录制功能前，请确保您已经集成了基础的多方音视频通话功能。")]),t._v(" "),n("h2",{attrs:{id:"设置录制参数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#设置录制参数"}},[t._v("#")]),t._v(" 设置录制参数")]),t._v(" "),n("p",[t._v("服务器音频视频录制将录制的文件保存在七牛云上，因此，需要在七牛云注册账号并获取 AccessKey、SecretKey、BucketName、fileKey。")]),t._v(" "),n("p",[t._v("AccessKey、SecretKey、BucketName、fileKey 获取之后，利用 JCMediaChannelRecordParam 对象中的 buildQiniuRecordParam 方法构造七牛录制参数")]),t._v(" "),n("div",{staticClass:"language-objectivec extra-class"},[n("pre",{pre:!0,attrs:{class:"language-objectivec"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * @brief 七牛录制参数构造\n *\n * @param video 是否是视频录制\n * @param bucketName 七牛云 bucketName\n * @param secretKey 七牛云 secretKey\n * @param accessKey 七牛云 accessKey\n * @param fileName 录制文件名\n * @return 录制参数字符串\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSString"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" __nonnull"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("buildQiniuRecordParam"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BOOL"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("video bucketName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSString"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" __nonnull"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("bucketName secretKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSString"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" __nonnull"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("secretKey accessKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSString"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" __nonnull"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("accessKey fileName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSString"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" __nonnull"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("fileName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("录制参数构造之后，在加入频道之前 通过 JCMediaChannelJoinParam 对象中的 JCMediaChannelRecordParam 对象传入录制参数。")]),t._v(" "),n("p",[t._v("其中，JCMediaChannelRecordParam 对象有以下属性")]),t._v(" "),n("div",{staticClass:"language-objectivec extra-class"},[n("pre",{pre:!0,attrs:{class:"language-objectivec"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n *  @brief 录制分辨率，参见 JCMediaChannelRecordResolution\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@property")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nonatomic"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" JCMediaChannelRecordResolution resolution"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// 录制字符串")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@property")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nonatomic"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" strong"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" NSString"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" __nonnull recoredString"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("JCMediaChannelRecordResolution 枚举值如下")]),t._v(" "),n("div",{staticClass:"language-objectivec extra-class"},[n("pre",{pre:!0,attrs:{class:"language-objectivec"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// 180p")]),t._v("\nJCMediaChannelRecordResolution180p "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// 360p")]),t._v("\nJCMediaChannelRecordResolution360p "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// 720p")]),t._v("\nJCMediaChannelRecordResolution720p "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x300")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// 1080p")]),t._v("\nJCMediaChannelRecordResolution1080p "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x400")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),n("p",[t._v("示例代码")]),t._v(" "),n("div",{staticClass:"language-objectivec extra-class"},[n("pre",{pre:!0,attrs:{class:"language-objectivec"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置录制参数")]),t._v("\nJCMediaChannelJoinParam "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("joinParam "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("JCMediaChannelJoinParam alloc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\njoinParam"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("record "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("JCMediaChannelRecordParam alloc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\njoinParam"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("record"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("resolution "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" JCMediaChannelRecordResolution360p"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\njoinParam"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("record"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("recoredString "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("JCMediaChannelRecordParam buildQiniuRecordParam"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("true bucketName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"QiNiuBucketName"')]),t._v(" secretKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"QiNiuSecretKey"')]),t._v(" accessKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"QiNiuAccessKey"')]),t._v(" fileName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"QiNiuFilename"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 加入频道")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mediaChannel join"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"channelId"')]),t._v(" joinParam"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("joinParam"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),n("p",[t._v("如果进行音频录制，需要将构造方法中的 video 值设为 false。")])]),t._v(" "),n("h2",{attrs:{id:"获取录制状态"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#获取录制状态"}},[t._v("#")]),t._v(" 获取录制状态")]),t._v(" "),n("p",[t._v("录制参数设置好后，需要根据目前的录制状态来判断是否启音视频录制。其中录制状态可通过 recordState 属性获得。")]),t._v(" "),n("p",[t._v("recordState 有")]),t._v(" "),n("div",{staticClass:"language-objectivec extra-class"},[n("pre",{pre:!0,attrs:{class:"language-objectivec"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// 无法进行视频录制")]),t._v("\nJCMediaChannelRecordStateNone"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// 可以开启视频录制")]),t._v("\nJCMediaChannelRecordStateReady"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// 视频录制中")]),t._v("\nJCMediaChannelRecordStateRunning"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),n("p",[t._v("录制状态的变化通过 onMediaChannelPropertyChange 回调上报")]),t._v(" "),n("div",{staticClass:"language-objectivec extra-class"},[n("pre",{pre:!0,attrs:{class:"language-objectivec"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n *  @brief 属性变化回调，目前主要关注屏幕共享状态的更新\n *  @param changeParam 变化标识集合\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("onMediaChannelPropertyChange"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("JCMediaChannelPropChangeParam "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("changeParam"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h2",{attrs:{id:"开启或关闭音视频录制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#开启或关闭音视频录制"}},[t._v("#")]),t._v(" 开启或关闭音视频录制")]),t._v(" "),n("p",[t._v("录制状态获取后，即可根据录制状态调用下面的接口开启或关闭音视频录制")]),t._v(" "),n("div",{staticClass:"language-objectivec extra-class"},[n("pre",{pre:!0,attrs:{class:"language-objectivec"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n *  @brief 开关视频录制\n *  @param enable 是否开启屏幕录制\n *  @param recordParam 录制参数，当 enable 为 true 时，可以更改由 join 时传入的录制参数，不需更改则填 nil\n *  @return 返回 true 表示正常执行调用流程，false 表示调用异常\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bool"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("enableRecord"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bool"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("enable recordParam"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("JCMediaChannelRecordParam"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" __nullable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("recordParam"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),n("p",[t._v("recordParam 录制参数，当 enable 为 true 时，可以更改由 join 时传入的录制参数，不需更改则填 nil。")])]),t._v(" "),n("p",[t._v("示例代码")]),t._v(" "),n("div",{staticClass:"language-objectivec extra-class"},[n("pre",{pre:!0,attrs:{class:"language-objectivec"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("onMediaChannelPropertyChange"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("JCMediaChannelPropChangeParam "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("changeParam "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("changeParam"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("recordState"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 录制状态变化")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 根据音视频录制状态判断是否开启音视频录制")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mediaChannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("recordState "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" JCMediaChannelRecordStateNone"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 无法进行音视频录制")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mediaChannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("recordState "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" JCMediaChannelRecordStateReady"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 可以开启音视频录制")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mediaChannel enableRecord"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("true recordParam"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("nil"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mediaChannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("recordState "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" JCMediaChannelRecordStateRunning"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 音视频录制中，可以关闭音视频录制")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mediaChannel enableRecord"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("false recordParam"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("nil"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);