---
title: 02_编写脚本
---
## 编写脚本清理 md 文件中的垃圾内容

1. 回顾 html 转 md 关键命令

   ```
   pandoc 00_overview.html -f html -t markdown_strict -o 00_overview.md
   ```

2. 递归遍历所有文件夹

   利用 pandoc 将文件夹中的 html转为 md

3. 但是生成的 md 不完全符合我们的规范，我们还需要：

   - 将网址相对路径调整为绝对路径

   - 删除奇怪的 span

   - 删除奇怪的 a

     删除文本中内容的 linux 命令行为：

     ```
     sed -i "" "s|被替换的内容|替换的内容|g" 文件路径
     ```

## 完整脚本

> 文档替换的内容仅适用于markdown_strict 样式

```
# 程序入口
if [ $# -ne 1 ]  
then  
  echo "USAGE: $0 TOP_DIR"  
else  
  genMarkdown $1  
fi

# 程序本体
function genMarkdown()  
{  
  # change from old to new
  old='.html'
  new='.md'

  # pandoc 的转换
  old_format="html"
  new_format="markdown_strict"

  for file in `ls $1`  
  do  
    # 遍历文件
    local path=$1"/"$file  
    echo "path $path"
    if [ -d $path ]  
      then  
      echo "DIR $path"  
      echo "delete index$old"
      rm -f $path/index$old
      genMarkdown $path  
    else  
      echo "FILE $path" # md
      # 转换 $old 后缀的文件
      if [ ."${path##*.}"x = "$old"x ];then
        # 去除去除文件后缀的路径 即 xxx/index
        name=${path%%.*}
        pandoc ${name}$old -f $old_format -t $new_format -o ${name}$new
        echo "changing  ${name}$old to ${name}$new!"

        # 将网址相对路径调整为绝对路径
        sed -i "" 's|href="/cn/document/V2.1/|href="https://developer.juphoon.com/cn/document/V2.1/|g' $name$new
        # 删除奇怪的 span
        sed -i "" "s|<span.*></span>||g" $name$new
        # 删除奇怪的 a
        sed -i "" "s|<a href=.*>¶</a>||g" $name$new

        # 删除原有的 $old 文件
        rm -f ${name}$old
      else
        echo "非${old}文件"
      fi
      echo "change done!"
    fi  

  done  
}  
echo "complete!"


```

## 后续

后续我们可能要对脚本进行扩展：

- 根据文档内容或者标题在行首添加 front matter
