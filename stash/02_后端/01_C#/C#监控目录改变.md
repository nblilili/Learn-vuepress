---
title: C#监控目录改变
---
## 简介

> 许多情况下，如果创建或修改一个文件，系统需要执行某些任务。例如，在一个数据库中插入平面文件的重要系统就是如此。
>
> 在这种情况下，程序必须监控目录中新建立的文件。如果目录中新建了一个文件，程序必须提取这个文件、进行解析、再把它插入到数据库中。
>
> 许多时候，这类功能要通过“调查”目录并列举上次调查后任何新建的文件来完成。在[.NET Framework](http://www.builder.com.cn/dotnet.shtml)中，微软为开发者提供另一种连续调查一个目录中的新建文件的方法——FileSystemWatcher对象。
>
> FileSystemWatcher对象为你完成目录监控工作。如果新建、更新或删除一个文件，FileSystemWatcher将提交一个事件，通知你发生了一项改变。这样，新建一个文件后，你的程序立即就知道可以使用这个文件。立即通知改变使得你的系统以更高的效率工作，因为你不能总是“调查”目录中发生的改变，而且在两次目录扫描之间也不会有时间流失

**FileSystemWatcher基础**

在应用FileSystemWatcher对象之前，你必须了解这个对象的一些基本属性和事件。毫无疑问，这个对象的最重要的属性为“EnableRaisingEvents”属性。

这个属性决定对象在收到改变通知时是否提交事件。如果EnableRaisingEvents属性设为假，对象将不会提交改变事件。如果设为真，它将提交改变事件。下面是你在应用FileSystemWatcher对象时将要用到的其它一些重要属性/事件：

**属性：**

- **Path**——这个属性告诉FileSystemWatcher它需要监控哪条路径。例如，如果我们将这个属性设为“C:Temp”，对象就监控那个目录发生的所有改变。
- **IncludeSubDirectories**——这个属性说明FileSystemWatcher对象是否应该监控子目录中发生的改变。
- **Filter**——这个属性允许你过滤掉某些类型的文件发生的变化。例如，如果我们只希望在TXT文件被修改/新建/删除时提交通知，可以将这个属性设为“*txt”。在处理高流量或大型目录时，使用这个属性非常方便。

**事件**

- **Changed**——当被监控的目录中有一个文件被修改时，就提交这个事件。值得注意的是，这个事件可能会被提交多次，即使文件的内容仅仅发生一项改变。这是由于在保存文件时，文件的其它属性也发生了改变。
- **Created**——当被监控的目录新建一个文件时，就提交这个事件。如果你计划用这个事件移动新建的事件，你必须在事件处理器中写入一些错误处理代码，它能处理当前文件被其它进程使用的情况。之所以要这样做，是因为Created事件可能在建立文件的进程释放文件之前就被提交。如果你没有准备正确处理这种情况的代码，就可能出现异常。
- **Deleted**——当被监控的目录中有一个文件被删除，就提交这个事件。
- **Renamed**——当被监控的目录中有一个文件被重命名，就提交这个事件。

**注**：如果你没有将EnableRaisingEvents设为真，系统不会提交任何一个事件。如果有时FileSystemWatcher对象似乎无法工作，请首先检查EnableRaisingEvents，确保它被设为真。

**事件处理**

当FileSystemWatcher调用一个事件处理器时，它包含两个自变量——一个叫做“sender”的对象和一个叫做“e”的FileSystemEventArgs对象。我们感兴趣的自变量为FileSystemEventArgs自变量。这个对象中包含有提交事件的原因。以下是FileSystemEventArgs对象的一些属性：

**属性：**

- **Name**——这个属性中使事件被提交的文件的名称。其中并不包含文件的路径——只包含使用事件被提交的文件或目录名称。
- **ChangeType**——这是一个WatcherChangeTypes，它指出要提交哪个类型的事件。其有效值包括：
  ○ Changed
  ○ Created
  ○ Deleted
  ○ Renamed
- **FullPath**——这个属性中包含使事件被提交的文件的完整路径，包括文件名和目录名。

---end---
