(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{343:function(e,n,a){e.exports=a.p+"assets/img/1-1workflowandroid.d9fa59f0.png"},475:function(e,n,a){"use strict";a.r(n);var t=a(43),o=Object(t.a)({},(function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"实现一对一视频通话"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实现一对一视频通话"}},[e._v("#")]),e._v(" 实现一对一视频通话")]),e._v(" "),t("p",[e._v("本章将介绍如何实现一对一视频通话，一对一视频通话的 API 调用时序见下图：")]),e._v(" "),t("p",[t("img",{attrs:{src:a(343),alt:"../../../../_images/1-1workflowandroid.png"}})]),e._v(" "),t("h2",{attrs:{id:"初始化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始化"}},[e._v("#")]),e._v(" 初始化")]),e._v(" "),t("p",[e._v("调用\n"),t("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaDevice.html#create-com.juphoon.cloud.JCClient-com.juphoon.cloud.JCMediaDeviceCallback-",target:"_blank",rel:"noopener noreferrer"}},[e._v("JCMediaDevice.create()"),t("OutboundLink")],1),e._v("\n和\n"),t("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCCall.html#create-com.juphoon.cloud.JCClient-com.juphoon.cloud.JCMediaDevice-com.juphoon.cloud.JCCallCallback-",target:"_blank",rel:"noopener noreferrer"}},[e._v("JCCall.create()"),t("OutboundLink")],1),e._v("\n以初始化实现一对一通话需要的模块")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("// 声明对象\nJCMediaDevice mMediaDevice;\nJCCall mCall;\n\n// 初始化函数\npublic boolean initialize(Context context) {\n    //1. 媒体类\n    mMediaDevice = JCMediaDevice.create(mClient, new JCMediaDeviceCallback() {\n        @Override\n        public void onCameraUpdate() {\n\n        }\n        @Override\n        public void onAudioOutputTypeChange(int i) {\n\n        }\n        @Override\n        public void onRenderReceived(JCMediaDeviceVideoCanvas jcMediaDeviceVideoCanvas) {\n\n        }\n        @Override\n        public void onRenderStart(JCMediaDeviceVideoCanvas jcMediaDeviceVideoCanvas) {\n\n        }\n    });\n    //2. 通话类\n    mCall = JCCall.create(mClient, mMediaDevice, new JCCallCallback() {\n        @Override\n        public void onCallItemAdd(JCCallItem jcCallItem) {\n\n        }\n\n        @Override\n        public void onCallItemRemove(JCCallItem jcCallItem, int i, String s) {\n\n        }\n\n        @Override\n        public void onCallItemUpdate(JCCallItem jcCallItem, JCCallItem.ChangeParam changeParam) {\n\n        }\n\n        @Override\n        public void onMessageReceive(String s, String s1, JCCallItem jcCallItem) {\n\n        }\n\n        @Override\n        public void onMissedCallItem(JCCallItem jcCallItem) {\n\n        }\n    });\n}\n")])])]),t("h2",{attrs:{id:"媒体参数设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#媒体参数设置"}},[e._v("#")]),e._v(" 媒体参数设置")]),e._v(" "),t("p",[e._v("一对一视频通话支持智能硬件设备集成，需要在发起通话前设置媒体参数:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("// 根据模式生成配置参数\nJCCall.MediaConfig mediaConfig = JCCall.MediaConfig.generateByMode(JCCall.MediaConfig.MODE_INTELLINGENT_HARDWARE_SMALL);\n// 设置媒体参数\nJCManager.shared.call.mediaConfig = mediaConfig;\n")])])]),t("p",[e._v("菊风提供三种配置模式供开发者选择，并开放相关属性供开发者进行灵活的自定义配置，具体方法请查看\n"),t("RouterLink",{attrs:{to:"/00_product/01_o2o_video/05_adv_func/Android/03_intelligent_hardware.html#android"}},[t("span",{staticClass:"std std-ref"},[e._v("媒体参数设置")])]),e._v("\n。")],1),e._v(" "),t("h2",{attrs:{id:"拨打通话"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#拨打通话"}},[e._v("#")]),e._v(" 拨打通话")]),e._v(" "),t("p",[e._v("调用\n"),t("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCCall.html#call-java.lang.String-boolean-java.lang.String-",target:"_blank",rel:"noopener noreferrer"}},[e._v("call()"),t("OutboundLink")],1),e._v("\n发起视频通话，需要填写的参数有：")]),e._v(" "),t("ul",[t("li",[t("p",[t("code",[e._v("userID")]),e._v(" 填写对方的用户ID。")])]),e._v(" "),t("li",[t("p",[t("code",[e._v("isVideo")]),e._v(" 选择是否为视频通话， true 表示拨打视频通话， false 表示拨打语音通话。")])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCCall.html#call-java.lang.String-boolean-java.lang.String-",target:"_blank",rel:"noopener noreferrer"}},[e._v("extraParam()"),t("OutboundLink")],1),e._v("\n为自定义透传字符串， 可通过\n"),t("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCCallItem.html#getExtraParam--",target:"_blank",rel:"noopener noreferrer"}},[e._v("getExtraParam()"),t("OutboundLink")],1),e._v("\n方法获取该属性。")]),e._v(" "),t("p",[e._v("// 发起语音呼叫\nmCall.call(userID, isVideo, null);")])])]),e._v(" "),t("p",[e._v("拨打通话后，主叫和被叫均会收到新增通话的回调\n"),t("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCCallCallback.html#onCallItemAdd-com.juphoon.cloud.JCCallItem-",target:"_blank",rel:"noopener noreferrer"}},[e._v("onCallItemAdd()"),t("OutboundLink")],1),e._v("\n，此时通话状态变为\n"),t("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCCall.html#STATE_PENDING",target:"_blank",rel:"noopener noreferrer"}},[e._v("STATE_PENDING"),t("OutboundLink")],1),e._v("\n。您可以通过重写\n"),t("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCCallCallback.html#onCallItemAdd-com.juphoon.cloud.JCCallItem-",target:"_blank",rel:"noopener noreferrer"}},[e._v("onCallItemAdd()"),t("OutboundLink")],1),e._v("\n执行逻辑操作。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("@Override\npublic void onCallItemAdd(JCCallItem item) {\n    // 业务逻辑\n    if (item.direction == JCCall.DIRECTION_IN) {\n        // 如果是被叫\n        ...\n    }else{\n        // 如果是主叫\n        ...\n    }\n}\n")])])]),t("h2",{attrs:{id:"创建本地视频画面"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建本地视频画面"}},[e._v("#")]),e._v(" 创建本地视频画面")]),e._v(" "),t("p",[e._v("发起通话后，调用\n"),t("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCCallItem.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("JCCallItem"),t("OutboundLink")],1),e._v("\n类中的\n"),t("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCCallItem.html#startSelfVideo-int-",target:"_blank",rel:"noopener noreferrer"}},[e._v("startSelfVideo()"),t("OutboundLink")],1),e._v("\n方法打开本地视频预览。需要填入参数\n"),t("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaDevice.html#RENDER_FULL_AUTO",target:"_blank",rel:"noopener noreferrer"}},[e._v("JCMediaDevice.RenderType"),t("OutboundLink")],1),e._v("\n以选择渲染模式。")]),e._v(" "),t("p",[e._v("示例代码:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v('// 1. 发起视频呼叫\nmCall.call("222", true, null);\n// 2. 获取当前活跃通话\nJCCallItem mCallItem = mCall.getActiveCallItem();\n// 3. 打开本地视频预览，这里选择的是自适应模式\nmCallItem.startSelfVideo(JCMediaDevice.RENDER_FULL_AUTO);\n')])])]),t("h2",{attrs:{id:"应答通话"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#应答通话"}},[e._v("#")]),e._v(" 应答通话")]),e._v(" "),t("p",[e._v("被叫收到\n"),t("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCCallCallback.html#onCallItemAdd-com.juphoon.cloud.JCCallItem-",target:"_blank",rel:"noopener noreferrer"}},[e._v("onCallItemAdd()"),t("OutboundLink")],1),e._v("\n回调，在回调中调用\n"),t("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCCallItem.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("JCCallItem"),t("OutboundLink")],1),e._v("\n中的\n"),t("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCCallItem.html#getVideo--",target:"_blank",rel:"noopener noreferrer"}},[e._v("getVideo()"),t("OutboundLink")],1),e._v("\n方法获取 "),t("code",[e._v("video")]),e._v(" 属性来判断是视频呼入还是语音呼入，从而做出相应的处理。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("@Override\npublic void onCallItemAdd(JCCallItem item) {\n    // 1. 如果是视频呼入且在振铃中\n    if (item.getDirection() == JCCall.DIRECTION_IN && item.getVideo()) {\n        // 2. 做出相应的处理，如在界面上显示“振铃中”\n        ...\n    }\n}\n")])])]),t("p",[e._v("调用\n"),t("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCCall.html#answer-java.lang.String-boolean-java.lang.String-",target:"_blank",rel:"noopener noreferrer"}},[e._v("answer()"),t("OutboundLink")],1),e._v("\n接听通话。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("mCall.answer(item, true);\n")])])]),t("p",[e._v("通话接听后，通话状态变为 STATE_CONNECTING。")]),e._v(" "),t("p",[e._v("Note")]),e._v(" "),t("p",[e._v("如果要在此时拒绝通话，请调用挂断通话的接口。这种情况下调用挂断后，通话状态变为 STATE_CANCELED。")]),e._v(" "),t("h2",{attrs:{id:"创建远端视频画面"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建远端视频画面"}},[e._v("#")]),e._v(" 创建远端视频画面")]),e._v(" "),t("p",[e._v("视频通话中，通常需要看到其他用户。被叫接听通话后，双方将建立连接，此时，主叫和被叫都将会收到通话更新的回调（onCallItemUpdate），通话状态变为\nSTATE_TALKING。")]),e._v(" "),t("p",[e._v("调用\n"),t("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCCallItem.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("JCCallItem"),t("OutboundLink")],1),e._v("\n类中的\n"),t("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCCallItem.html#startOtherVideo-int-",target:"_blank",rel:"noopener noreferrer"}},[e._v("startOtherVideo()"),t("OutboundLink")],1),e._v("\n获取远端视频画面。返回对象为\n"),t("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaDeviceVideoCanvas.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("JCMediaDeviceVideoCanvas"),t("OutboundLink")],1),e._v("。")]),e._v(" "),t("p",[e._v("示例代码:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("@Override\npublic void onCallItemUpdate(JCCallItem item) {\n    // 如果对端在上传视频流（uploadVideoStreamOther）\n    // mRemoteCanvas 为 JCMediaDeviceVideoCanvas 对象实例，请在方法前声明。\n    if (item.getState() == JCCall.STATE_TALKING && mRemoteCanvas == null && item.getUploadVideoStreamOther()) {\n        // 获取远端视频画面，renderId来源JCCallItem对象\n        JCMediaDeviceVideoCanvas mRemoteCanvas = item.startOtherVideo(JCMediaDevice.RENDER_FULL_CONTENT);\n        ...\n    }\n}\n")])])]),t("h2",{attrs:{id:"挂断通话"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#挂断通话"}},[e._v("#")]),e._v(" 挂断通话")]),e._v(" "),t("p",[e._v("主叫或者被叫均可以挂断通话。")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("调用\n"),t("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCCall.html#getActiveCallItem--",target:"_blank",rel:"noopener noreferrer"}},[e._v("getActiveCallItem()"),t("OutboundLink")],1),e._v("\n获取当前活跃的通话对象:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("mCall.getActiveCallItem();\n")])])])]),e._v(" "),t("li",[t("p",[e._v("调用\n"),t("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCCall.html#term-com.juphoon.cloud.JCCallItem-int-java.lang.String-",target:"_blank",rel:"noopener noreferrer"}},[e._v("term()"),t("OutboundLink")],1),e._v("\n挂断当前活跃通话:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("mCall.term(item, reason, description);\n")])])])])]),e._v(" "),t("p",[e._v("示例代码:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("// 1. 获取当前活跃通话\nJCCallItem item = mCall.getActiveCallItem();\n// 2. 挂断当前活跃通话\nmCall.term(item, JCCall.REASON_NONE, null);\n")])])]),t("h2",{attrs:{id:"销毁本地和远端视频画面"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#销毁本地和远端视频画面"}},[e._v("#")]),e._v(" 销毁本地和远端视频画面")]),e._v(" "),t("p",[e._v("通话挂断后，收到移除通话的回调\n"),t("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCCallCallback.html#onCallItemRemove-com.juphoon.cloud.JCCallItem-int-java.lang.String-",target:"_blank",rel:"noopener noreferrer"}},[e._v("onCallItemRemove()"),t("OutboundLink")],1),e._v("\n，通话状态变为\n"),t("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCCall.html#STATE_OK",target:"_blank",rel:"noopener noreferrer"}},[e._v("STATE_OK"),t("OutboundLink")],1),e._v("\n，此时您需要分别调用\n"),t("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCCallItem.html#stopSelfVideo--",target:"_blank",rel:"noopener noreferrer"}},[e._v("stopSelfVideo()"),t("OutboundLink")],1),e._v("\n和\n"),t("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCCallItem.html#stopOtherVideo--",target:"_blank",rel:"noopener noreferrer"}},[e._v("stopOtherVideo()"),t("OutboundLink")],1),e._v("\n销毁本地和远端视频画面。")]),e._v(" "),t("p",[e._v("示例代码:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("@Override\npublic void onCallItemRemove(JCCallItem item, @JCCall.CallReason int reason, String description) {\n    // 销毁本地视频画面\n    item.stopSelfVideo();\n    // 销毁远端视频画面\n    item.stopOtherVideo();\n}\n")])])]),t("h2",{attrs:{id:"待机功耗优化方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#待机功耗优化方案"}},[e._v("#")]),e._v(" 待机功耗优化方案")]),e._v(" "),t("p",[e._v("针对手表端 JC SDK 待机功耗的问题，菊风提供对应的解决方案，详细内容参考：\n"),t("RouterLink",{attrs:{to:"/00_product/01_o2o_video/05_adv_func/Android/03_intelligent_hardware.html#id5"}},[t("span",{staticClass:"std std-ref"},[e._v("待机功耗优化方案")])]),e._v("\n。")],1)])}),[],!1,null,null,null);n.default=o.exports}}]);