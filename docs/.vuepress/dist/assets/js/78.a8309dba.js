(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{344:function(e,t,r){e.exports=r.p+"assets/img/1-1workflowWindows.d9fa59f0.png"},541:function(e,t,r){"use strict";r.r(t);var n=r(43),a=Object(n.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"实现一对一通话"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实现一对一通话"}},[e._v("#")]),e._v(" 实现一对一通话")]),e._v(" "),n("p",[e._v("本章将介绍如何实现一对一视频通话，一对一视频通话的 API 调用时序见下图：")]),e._v(" "),n("p",[n("img",{attrs:{src:r(344),alt:"../../../../_images/1-1workflowWindows.png"}})]),e._v(" "),n("h2",{attrs:{id:"初始化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#初始化"}},[e._v("#")]),e._v(" 初始化")]),e._v(" "),n("p",[e._v("调用\n"),n("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/windows/html/cb59bc27-6528-9dbf-c996-de857096f847.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("JCMediaDevice.create()"),n("OutboundLink")],1),e._v("\n和\n"),n("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/windows/html/eef10110-a3f7-b505-26fa-4b9ec1e2b998.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("JCCall.create()"),n("OutboundLink")],1),e._v("\n以初始化实现一对一通话需要的模块：")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("/// 新建类并实现\nclass JCManager : JCClientCallback, JCMediaDeviceCallback,JCCallCallbac{\n\n    #region JCMediaDeviceCallback\n\n    public void onCameraUpdate(){...}\n\n    public void onAudioOutputTypeChange(string audioOutputType){...}\n\n    #endregion\n\n    #region JCCallCallbac\n    ...\n    /// 实现 JCCallCallbac 中的方法\n    ...\n    #endregion\n\n    /// 声明对象\n    JCMediaDevice mMediaDevice;\n    JCMediaChannel mMediaChannel;\n\n    /// 初始化函数\n    public bool initialize(Context context) {\n\n        /// 1. 媒体类\n        mMediaDevice = JCMediaDevice.create(mClient, this);\n        /// 2. 通话类\n        mCall = JCCall.create(mClient, mMediaDevice, this);\n    }\n}\n")])])]),n("h2",{attrs:{id:"拨打通话"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#拨打通话"}},[e._v("#")]),e._v(" 拨打通话")]),e._v(" "),n("p",[e._v("调用\n"),n("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/windows/html/613adf03-d597-8221-86d5-0056c1b4d2a0.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("call()"),n("OutboundLink")],1),e._v("\n发起视频通话，需要填写的参数有：")]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("userID")]),e._v(" 填写对方的用户ID。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("video")]),e._v(" 选择是否为视频通话， true 表示拨打视频通话， false 表示拨打语音通话。")])]),e._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/windows/html/e0226cbc-1ca1-ef9c-5e8e-d3dc853d618d.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("extraParam()"),n("OutboundLink")],1),e._v("\n为自定义透传字符串， 可通过 "),n("code",[e._v("item.extraParam")]),e._v(" 获取该属性。")]),e._v(" "),n("p",[e._v("/// 发起语音呼叫\nmCall.call(userID, isVideo, null);")])])]),e._v(" "),n("p",[e._v("拨打通话后，主叫和被叫均会收到新增通话的回调\n"),n("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/windows/html/5e605b62-c8dc-4dde-2480-8fdcbbfc2f48.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("onCallItemAdd()"),n("OutboundLink")],1),e._v("\n，此时通话状态变为\n"),n("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/windows/html/2134e734-614d-4a19-f411-5fe1a81d3ccd.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("STATE_PENDING"),n("OutboundLink")],1),e._v("\n。您可以通过重写\n"),n("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/windows/html/5e605b62-c8dc-4dde-2480-8fdcbbfc2f48.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("onCallItemAdd()"),n("OutboundLink")],1),e._v("\n执行逻辑操作。")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("public void onCallItemAdd(JCCallItem item) {\n    /// 业务逻辑\n    if (item.direction == JCCall.DIRECTION_IN) {\n        /// 如果是被叫\n        ...\n    }else{\n        /// 如果是主叫\n        ...\n    }\n}\n")])])]),n("h2",{attrs:{id:"创建本地视频画面"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建本地视频画面"}},[e._v("#")]),e._v(" 创建本地视频画面")]),e._v(" "),n("p",[e._v("发起通话后，调用\n"),n("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/windows/html/0267696e-79ee-8d46-c086-3c071a2b2b3a.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("JCCallItem"),n("OutboundLink")],1),e._v("\n类中的\n"),n("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/windows/html/d399b6b1-b822-b6aa-de75-f35d6815e93b.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("startSelfVideo()"),n("OutboundLink")],1),e._v("\n方法打开本地视频预览。需要填入参数\n"),n("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/windows/html/44604552-33eb-5a81-6b10-6c512d127a4b.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("JCMediaDevice.RenderType"),n("OutboundLink")],1),e._v("\n以选择渲染模式。")]),e._v(" "),n("p",[e._v("示例代码:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v('/// 1. 发起视频呼叫\nmCall.call("222", true, null);\n/// 2. 获取当前活跃通话\nJCCallItem mCallItem = mCall.getActiveCallItem();\n/// 3. 打开本地视频预览，这里选择的是自适应模式\nmCallItem.startSelfVideo(JCMediaDevice.RENDER_FULL_AUTO);\n')])])]),n("h2",{attrs:{id:"应答通话"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#应答通话"}},[e._v("#")]),e._v(" 应答通话")]),e._v(" "),n("p",[e._v("被叫收到\n"),n("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/windows/html/5e605b62-c8dc-4dde-2480-8fdcbbfc2f48.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("onCallItemAdd()"),n("OutboundLink")],1),e._v("\n回调，在回调中根据\n"),n("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/windows/html/0267696e-79ee-8d46-c086-3c071a2b2b3a.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("JCCallItem"),n("OutboundLink")],1),e._v("\n属性来判断是视频呼入还是语音呼入，从而做出相应的处理。")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("public void onCallItemAdd(JCCallItem item) {\n    /// 1. 如果是视频呼入且在振铃中\n    if (item.direction == JCCall.DIRECTION_IN && item.video) {\n        /// 2. 做出相应的处理，如在界面上显示“振铃中”\n        ...\n    }\n}\n")])])]),n("p",[e._v("调用\n"),n("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/windows/html/7211e914-c311-4457-4b0e-bc4ef46c7733.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("answer()"),n("OutboundLink")],1),e._v("\n接听通话。")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("mCall.answer(item, true);\n")])])]),n("p",[e._v("通话接听后，通话状态变为 STATE_CONNECTING。")]),e._v(" "),n("p",[e._v("Note")]),e._v(" "),n("p",[e._v("如果要在此时拒绝通话，请调用挂断通话的接口。这种情况下调用挂断后，通话状态变为 STATE_CANCELED。")]),e._v(" "),n("h2",{attrs:{id:"创建远端视频画面"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建远端视频画面"}},[e._v("#")]),e._v(" 创建远端视频画面")]),e._v(" "),n("p",[e._v("被叫接听通话后，双方将建立连接，此时，主叫和被叫都将会收到通话更新的回调（onCallItemUpdate），通话状态变为\nSTATE_TALKING。")]),e._v(" "),n("p",[e._v("调用\n"),n("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/windows/html/0267696e-79ee-8d46-c086-3c071a2b2b3a.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("JCCallItem"),n("OutboundLink")],1),e._v("\n类中的\n"),n("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/windows/html/a4bdbd97-6a97-002f-9c9e-6e4774e4e708.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("startOtherVideo()"),n("OutboundLink")],1),e._v("\n获取远端视频画面。返回对象为\n"),n("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/windows/html/6a5b853c-d890-c30e-d236-5728d789ace1.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("JCMediaDeviceVideoCanvas"),n("OutboundLink")],1),e._v("。")]),e._v(" "),n("p",[e._v("示例代码:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("public void onCallItemUpdate(JCCallItem item) {\n    /// 如果对端在上传视频流（uploadVideoStreamOther）\n    /// mRemoteCanvas 为 JCMediaDeviceVideoCanvas 对象实例，请在方法前声明。\n    if (item.state == JCCall.STATE_TALKING && mRemoteCanvas == null && item.getUploadVideoStreamOther()) {\n        /// 获取远端视频画面，renderId来源JCCallItem对象\n        JCMediaDeviceVideoCanvas mRemoteCanvas = item.startOtherVideo(JCMediaDevice.RENDER_FULL_CONTENT);\n        ...\n    }\n}\n")])])]),n("h2",{attrs:{id:"挂断通话"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#挂断通话"}},[e._v("#")]),e._v(" 挂断通话")]),e._v(" "),n("p",[e._v("主叫或者被叫均可以挂断通话。")]),e._v(" "),n("ol",[n("li",[n("p",[e._v("调用\n"),n("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/windows/html/6df31ff9-272f-c7cc-1da6-2755c5aad5e0.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("getActiveCallItem()"),n("OutboundLink")],1),e._v("\n获取当前活跃的通话对象:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("mCall.getActiveCallItem();\n")])])])]),e._v(" "),n("li",[n("p",[e._v("调用\n"),n("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/windows/html/70758778-1450-172d-8684-3dd2818f2a84.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("term()"),n("OutboundLink")],1),e._v("\n挂断当前活跃通话:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("mCall.term(item, reason, description);\n")])])])])]),e._v(" "),n("p",[e._v("示例代码:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("/// 1. 获取当前活跃通话\nJCCallItem item = mCall.getActiveCallItem();\n/// 2. 挂断当前活跃通话\nmCall.term(item, JCCall.REASON_NONE, null);\n")])])]),n("h2",{attrs:{id:"销毁本地和远端视频画面"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#销毁本地和远端视频画面"}},[e._v("#")]),e._v(" 销毁本地和远端视频画面")]),e._v(" "),n("p",[e._v("通话挂断后，收到移除通话的回调\n"),n("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/windows/html/c6de8b41-37d7-a303-7761-0a3bc1caf18b.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("onCallItemRemove()"),n("OutboundLink")],1),e._v("\n，通话状态变为\n"),n("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/windows/html/2134e734-614d-4a19-f411-5fe1a81d3ccd.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("STATE_OK"),n("OutboundLink")],1),e._v("\n，此时您需要分别调用\n"),n("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/windows/html/d51a3870-b54f-5149-3b9a-a1d017721d00.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("stopSelfVideo()"),n("OutboundLink")],1),e._v("\n和\n"),n("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/windows/html/4cc26d8d-a4d4-1b2c-8917-b5ed4e048a28.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("stopOtherVideo()"),n("OutboundLink")],1),e._v("\n销毁本地和远端视频画面。")]),e._v(" "),n("p",[e._v("示例代码:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("public void onCallItemRemove(JCCallItem item, JCCallReason reason, String description) {\n    /// 销毁本地视频画面\n    item.stopSelfVideo();\n    /// 销毁远端视频画面\n    item.stopOtherVideo();\n}\n")])])])])}),[],!1,null,null,null);t.default=a.exports}}]);