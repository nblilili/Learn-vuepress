(window.webpackJsonp=window.webpackJsonp||[]).push([[103],{312:function(e,n,a){e.exports=a.p+"assets/img/multivideoworkflow.85fcfb5a.png"},457:function(e,n,a){"use strict";a.r(n);var r=a(43),o=Object(r.a)({},(function(){var e=this,n=e.$createElement,r=e._self._c||n;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"实现多方视频通话"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#实现多方视频通话"}},[e._v("#")]),e._v(" 实现多方视频通话")]),e._v(" "),r("p",[e._v("本章将介绍如何实现多方视频通话，多方视频通话的 API 调用时序见下图：")]),e._v(" "),r("p",[r("img",{attrs:{src:a(312),alt:"../../../../_images/multivideoworkflow.png"}})]),e._v(" "),r("h2",{attrs:{id:"初始化"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#初始化"}},[e._v("#")]),e._v(" 初始化")]),e._v(" "),r("p",[e._v("调用\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaDevice.html#create-com.juphoon.cloud.JCClient-com.juphoon.cloud.JCMediaDeviceCallback-",target:"_blank",rel:"noopener noreferrer"}},[e._v("JCMediaDevice.create()"),r("OutboundLink")],1),e._v("\n和\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannel.html#create-com.juphoon.cloud.JCClient-com.juphoon.cloud.JCMediaDevice-com.juphoon.cloud.JCMediaChannelCallback-",target:"_blank",rel:"noopener noreferrer"}},[e._v("JCMediaChannel.create()"),r("OutboundLink")],1),e._v("\n以初始化实现多方通话需要的模块：:")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v("// 声明对象\nJCMediaDevice mMediaDevice;\nJCMediaChannel mMediaChannel;\n\n// 初始化函数\npublic boolean initialize(Context context) {\n\n    //1. 媒体类\n    mMediaDevice = JCMediaDevice.create(mClient, new JCMediaDeviceCallback() {\n        @Override\n        public void onCameraUpdate() {\n\n        }\n        @Override\n        public void onAudioOutputTypeChange(int i) {\n\n        }\n        @Override\n        public void onRenderReceived(JCMediaDeviceVideoCanvas jcMediaDeviceVideoCanvas) {\n\n        }\n        @Override\n        public void onRenderStart(JCMediaDeviceVideoCanvas jcMediaDeviceVideoCanvas) {\n\n        }\n    });\n    // 2. 媒体通道类\n    mMediaChannel = JCMediaChannel.create(client, mediaDevice, new JCMediaChannelCallback() {\n        @Override\n        public void onMediaChannelStateChange(int i, int i1) {\n\n        }\n        @Override\n        public void onMediaChannelPropertyChange(JCMediaChannel.PropChangeParam propChangeParam) {\n\n        }\n        @Override\n        public void onJoin(boolean b, int i, String s) {\n\n        }\n        @Override\n        public void onLeave(int i, String s) {\n\n        }\n        @Override\n        public void onStop(boolean b, int i) {\n\n        }\n        @Override\n        public void onQuery(int i, boolean b, int i1, JCMediaChannelQueryInfo jcMediaChannelQueryInfo) {\n\n        }\n        @Override\n        public void onParticipantJoin(JCMediaChannelParticipant jcMediaChannelParticipant) {\n\n        }\n        @Override\n        public void onParticipantLeft(JCMediaChannelParticipant jcMediaChannelParticipant) {\n\n        }\n        @Override\n        public void onParticipantUpdate(JCMediaChannelParticipant jcMediaChannelParticipant, JCMediaChannelParticipant.ChangeParam changeParam) {\n\n        }\n        @Override\n        public void onMessageReceive(String s, String s1, String s2) {\n\n        }\n        @Override\n        public void onInviteSipUserResult(int i, boolean b, int i1) {\n\n        }\n        @Override\n        public void onParticipantVolumeChange(JCMediaChannelParticipant jcMediaChannelParticipant) {\n\n        }\n    });\n}\n")])])]),r("h2",{attrs:{id:"加入频道"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#加入频道"}},[e._v("#")]),e._v(" 加入频道")]),e._v(" "),r("ol",[r("li",[r("p",[e._v("调用\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannel.html#enableUploadAudioStream-boolean-",target:"_blank",rel:"noopener noreferrer"}},[e._v("enableUploadAudioStream()"),r("OutboundLink")],1),e._v("\n开启音频流。若要开启视频，调用\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannel.html#enableUploadVideoStream-boolean-",target:"_blank",rel:"noopener noreferrer"}},[e._v("enableUploadVideoStream()"),r("OutboundLink")],1),e._v("\n开启视频流。")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v("// 1. 开启音频流\nmMediaDeviceChannel.enableUploadAudioStream(true);\n// 2. 开启视频流（语音无需调用此方法）\nmMediaDeviceChannel.enableUploadVIdeoStream(true);\n")])])])]),e._v(" "),r("li",[r("p",[e._v("创建并加入频道，需要传入 "),r("code",[e._v("channelIdOrUri")]),e._v(" 和\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannel.JoinParam.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("JCMediaChannel.JoinParam"),r("OutboundLink")],1),e._v("\n。")]),e._v(" "),r("blockquote",[r("ul",[r("li",[r("p",[r("code",[e._v("channelIdOrUri")]),e._v(" 表示频道 ID 或频道 Uri。")])]),e._v(" "),r("li",[r("p",[r("code",[e._v("JCMediaChannelJoinParam")]),e._v(" 中 "),r("code",[e._v("uriMode")]),e._v(" 参数设置为 true 时表示传入频道\nUri，设置其他参数时表示传入频道 ID。传入相同的频道 ID 或相同的频道 Uri 的用户会进入同一个频道。")]),e._v(" "),r("p",[e._v('mMediaChannel.join("222", null);')])])])])]),e._v(" "),r("li",[r("p",[e._v("加入频道后收到\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannelCallback.html#onJoin-boolean-int-java.lang.String-",target:"_blank",rel:"noopener noreferrer"}},[e._v("onJoin()"),r("OutboundLink")],1),e._v("\n回调。")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v("@Override\npublic void onJoin(boolean result, @JCMediaChannel MediaChannelReason int reason, String channelId) {\n    if (result) {\n        // 加入频道成功\n    } else {\n        // 加入频道失败\n    }\n}\n")])])])])]),e._v(" "),r("h2",{attrs:{id:"创建本地视频画面"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#创建本地视频画面"}},[e._v("#")]),e._v(" 创建本地视频画面")]),e._v(" "),r("p",[e._v("加入频道后，调用\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannel.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("JCMediaChannel"),r("OutboundLink")],1),e._v("\n中的\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannel.html#getSelfParticipant--",target:"_blank",rel:"noopener noreferrer"}},[e._v("getSelfParticipant()"),r("OutboundLink")],1),e._v("\n获取频道内自身对象， 然后调用\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannelParticipant.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("JCMediaChannelParticipant"),r("OutboundLink")],1),e._v("\n中的\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannelParticipant.html#startVideo-int-int-",target:"_blank",rel:"noopener noreferrer"}},[e._v("startVideo()"),r("OutboundLink")],1),e._v("\n方法打开本地视频预览。返回对象为\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaDeviceVideoCanvas.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("JCMediaDeviceVideoCanvas"),r("OutboundLink")],1),e._v("。（调用此方法会打开摄像头）")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v("// 打开本地视频预览\nmMediaChannel.getSelfParticipant().startVideo(JCMediaDevice.RENDER_FULL_CONTENT, JCMediaChannel.PICTURESIZE_NONE);\n")])])]),r("h2",{attrs:{id:"创建远端视频画面"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#创建远端视频画面"}},[e._v("#")]),e._v(" 创建远端视频画面")]),e._v(" "),r("p",[e._v("视频通话中，通常需要看到其他用户。加入频道后，调用\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannel.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("JCMediaChannel"),r("OutboundLink")],1),e._v("\n中的\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannel.html#getParticipants--",target:"_blank",rel:"noopener noreferrer"}},[e._v("getParticipants()"),r("OutboundLink")],1),e._v("\n获取频道内所有成员对象。")]),e._v(" "),r("p",[e._v("然后调用\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannelParticipant.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("JCMediaChannelParticipant"),r("OutboundLink")],1),e._v("\n类中的\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannelParticipant.html#startVideo-int-int-",target:"_blank",rel:"noopener noreferrer"}},[e._v("startVideo()"),r("OutboundLink")],1),e._v("\n获取远端视频画面。返回对象为\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaDeviceVideoCanvas.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("JCMediaDeviceVideoCanvas"),r("OutboundLink")],1),e._v("。")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannelParticipant.html#startVideo-int-int-",target:"_blank",rel:"noopener noreferrer"}},[e._v("startVideo()"),r("OutboundLink")],1),e._v("\n方法调用后，还需要调用\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannel.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("JCMediaChannel"),r("OutboundLink")],1),e._v("\n中的\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannel.html#requestVideo-com.juphoon.cloud.JCMediaChannelParticipant-int-",target:"_blank",rel:"noopener noreferrer"}},[e._v("requestVideo()"),r("OutboundLink")],1),e._v("\n方法请求频道中其他用户的视频流。")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v("// 获取所有成员对象\nList<JCMediaChannelParticipant> participants = mMediaChannel.getSelfParticipant();\n// 调用创建视频画面的方法\nparticipants.get(0).startVideo(JCMediaDevice.RENDER_FULL_CONTENT, JCMediaChannel.PICTURESIZE_NONE);\n// 请求远端视频流, 此处调用大尺寸视频窗口\nmMediaChannel.requestVideo(participants.get(0), PICTURESIZE_LARGE);\n")])])]),r("h2",{attrs:{id:"离开频道"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#离开频道"}},[e._v("#")]),e._v(" 离开频道")]),e._v(" "),r("p",[e._v("调用\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannel.html#leave--",target:"_blank",rel:"noopener noreferrer"}},[e._v("leave()"),r("OutboundLink")],1),e._v("\n方法可以离开当前频道。")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v("mMediaChannel.leave();\n")])])]),r("p",[e._v("在多方视频通话中，离开频道还需要调用\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannelParticipant.html#stopVideo--",target:"_blank",rel:"noopener noreferrer"}},[e._v("stopVideo()"),r("OutboundLink")],1),e._v("\n移除视频画面。")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v("mParticipant.stopVideo();\n")])])]),r("p",[e._v("离开频道后，自身收到\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannelCallback.html#onLeave-int-java.lang.String-",target:"_blank",rel:"noopener noreferrer"}},[e._v("onLeave()"),r("OutboundLink")],1),e._v("\n回调，其他成员同时收到\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannelCallback.html#onParticipantLeft-com.juphoon.cloud.JCMediaChannelParticipant-",target:"_blank",rel:"noopener noreferrer"}},[e._v("onParticipantLeft()"),r("OutboundLink")],1),e._v("\n回调。")]),e._v(" "),r("h2",{attrs:{id:"销毁本地和远端视频画面"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#销毁本地和远端视频画面"}},[e._v("#")]),e._v(" 销毁本地和远端视频画面")]),e._v(" "),r("p",[e._v("调用\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannelParticipant.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("JCMediaChannelParticipant"),r("OutboundLink")],1),e._v("\n里的\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannelParticipant.html#stopVideo--",target:"_blank",rel:"noopener noreferrer"}},[e._v("stopVideo()"),r("OutboundLink")],1),e._v("\n销毁本地和远端视频画面。")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v("// 离开频道结果回调\n@Override\npublic void onLeave(@JCMediaChannel.MediaChannelReason int reason, String channelId) {\n    ...\n    // 销毁视频画面\n    mParticipant.stopVideo();\n}\n")])])]),r("h2",{attrs:{id:"解散频道"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#解散频道"}},[e._v("#")]),e._v(" 解散频道")]),e._v(" "),r("p",[e._v("如果想解散频道，可以调用下面的接口，此时所有成员都将被退出。")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v("// 结束频道\nmMediaChannel.stop();\n")])])]),r("p",[e._v("在多方视频通话中，离开频道还需要调用\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannelParticipant.html#stopVideo--",target:"_blank",rel:"noopener noreferrer"}},[e._v("stopVideo()"),r("OutboundLink")],1),e._v("\n移除视频画面。")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v("mParticipant.stopVideo();\n")])])]),r("p",[e._v("解散频道后，发起结束的成员收到\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannelCallback.html#onStop-boolean-int-",target:"_blank",rel:"noopener noreferrer"}},[e._v("onStop()"),r("OutboundLink")],1),e._v("\n回调，其他成员同时收到\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannelCallback.html#onLeave-int-java.lang.String-",target:"_blank",rel:"noopener noreferrer"}},[e._v("onLeave()"),r("OutboundLink")],1),e._v("\n回调。 解散失败原因枚举值请参考\n"),r("a",{attrs:{href:"https://developer.juphoon.com/portal/reference/V2.1/android/com/juphoon/cloud/JCMediaChannel.html#REASON_ALREADY_JOINED",target:"_blank",rel:"noopener noreferrer"}},[e._v("MediaChannelReason"),r("OutboundLink")],1),e._v("\n。")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v("@Override\npublic void onStop(boolean result, @JCMediaChannel.MediaChannelReason int reason) {\n    // 销毁视频， canvas 为 JCMediaDeviceVideoCanvas 对象实例\n    mParticipant.stopVideo();\n    canvas = null;\n}\n")])])])])}),[],!1,null,null,null);n.default=o.exports}}]);